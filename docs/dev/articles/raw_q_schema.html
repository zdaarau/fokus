<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FOKUS questionnaire schema • fokus</title>
<!-- jquery --><script src="../jquery.min.js"></script><!-- Bootstrap --><link rel="stylesheet" href="../yeti.min.css">
<script src="../bootstrap.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="../font-awesome/css/all.min.css">
<link rel="stylesheet" href="../font-awesome/css/v4-shims.min.css">
<!-- clipboard.js --><script src="../clipboard.min.js"></script><!-- headroom.js --><script src="../headroom.min.js"></script><script src="../jQuery.headroom.min.js"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="FOKUS questionnaire schema">
<meta name="description" content="fokus">
<meta property="og:description" content="fokus">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@2BSalim">
<meta name="twitter:site" content="@2BSalim">
<meta name="robots" content="noindex">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fokus</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.9011</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/raw_q_schema.html">FOKUS questionnaire schema</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://gitlab.com/zdaarau/rpkgs/fokus/" class="external-link">
    <span class="fab fa-gitlab fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="raw_q_schema_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>FOKUS questionnaire schema</h1>
            <h3 data-toc-skip class="subtitle">Structure and semantic rules of the raw TOML questionnaire</h3>
            
            <h4 data-toc-skip class="date">2021-10-21</h4>
      
      <small class="dont-index">Source: <a href="https://gitlab.com/zdaarau/rpkgs/fokus/blob/master/vignettes/raw_q_schema.Rmd" class="external-link"><code>vignettes/raw_q_schema.Rmd</code></a></small>
      <div class="hidden name"><code>raw_q_schema.Rmd</code></div>

    </div>

    
    
<div id="main-semantic-rules" class="section level1">
<h1 class="hasAnchor">
<a href="#main-semantic-rules" class="anchor"></a>Main semantic rules</h1>
<p>The <a href="https://gitlab.com/zdaarau/rpkgs/fokus/-/tree/master/data-raw/questionnaire/questionnaire.toml" class="external-link">raw questionnaire</a> is written in the <a href="https://toml.io/en/latest" class="external-link">TOML file format</a>. Basically, all questionnaire items are defined in an <a href="https://en.wikipedia.org/wiki/Tree_(graph_theory)#Ordered_tree" class="external-link">ordered tree structure</a> where child nodes inherit the attributes of their parent (and transitively grandparent etc.) nodes.</p>
<p>The following main semantic rules apply:</p>
<ol style="list-style-type: decimal">
<li>
<p>Top table level (<code>blockname</code>) defines a questionnaire block<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, whereby the (alphabetical) order of the table levels conforms to the order of the blocks in the questionnaire:</p>
<pre><code>[blockname]</code></pre>
</li>
<li>
<p>Lower table level names ideally start with a 3-digit number (<code>###</code>) since table levels (and hence questionnare items below them) are always ordered according to the (alphabetical) order of their names:</p>
<pre><code>[blockname.00X_2nd_lvl.00X_3rd_lvl]</code></pre>
</li>
<li>
<p>Deepest<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> table level named <code>item</code> defines an “atomic” questionnaire item (= single row in Markdown questionnaires) or a template for multiple similar “atomic” questionnaire items. It can be defined multiple times (once for each item) and must be wrapped in double brackets:</p>
<pre><code>[[blockname.00X_2nd_lvl.00X_3rd_lvl.item]]</code></pre>
<p>Items appear in the final questionnaire in the same order they are defined here. Technically, the level <code>item</code> is an <a href="https://toml.io/en/latest#array-of-tables" class="external-link">array of tables</a> which is represented as a list of unnamed lists in R.</p>
</li>
<li>
<p>Table levels in between top and deepest level <code>item</code> can be named anything except <code>variable_name</code> and are intended to arrange and/or group items and set keys that hold for multiple questionnaire items hierarchically in order to avoid redundancies.</p>
<p><strong>NOTE:</strong> It is still strongly discouraged to name table levels the same as any of the keys listed below.</p>
</li>
</ol>
</div>
<div id="supported-keys" class="section level1">
<h1 class="hasAnchor">
<a href="#supported-keys" class="anchor"></a>Supported keys</h1>
<p>Depending on the table level, the set of possible keys includes:</p>
<ul>
<li>
<p>Only regarded on top level (“block”):</p>
<table class="table">
<colgroup>
<col width="5%">
<col width="9%">
<col width="5%">
<col width="79%">
</colgroup>
<thead><tr class="header">
<th>Key</th>
<th>Type</th>
<th>Optional</th>
<th>Remarks</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>title</code></td>
<td>character scalar</td>
<td>❌</td>
<td>block title</td>
</tr>
<tr class="even">
<td><code>intro</code></td>
<td>character scalar</td>
<td>✅</td>
<td>text paragraph introducing the questionnaire items of the block</td>
</tr>
<tr class="odd">
<td><code>prefix</code></td>
<td>integer scalar</td>
<td>✅</td>
<td>block numbering prefix for the first questionnaire column <code>#</code>; if not provided, items will be auto-numbered (across all blocks without a <code>prefix</code>)</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Regarded on all levels incl. individual <code>item</code>-level nodes:</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="4%">
<col width="8%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="66%">
</colgroup>
<thead><tr class="header">
<th align="left"><strong>Key</strong></th>
<th align="left"><strong>Type</strong></th>
<th align="left"><strong>Default Value</strong></th>
<th align="left"><strong>Optional</strong></th>
<th align="left"><strong>Iterator</strong></th>
<th align="left"><strong>Excluder</strong></th>
<th align="left"><strong>Remarks</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>lvl</code></td>
<td align="left">character vector</td>
<td align="left"><code>"?"</code></td>
<td align="left">❌</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">political-level iterator</td>
</tr>
<tr class="even">
<td align="left"><code>i</code></td>
<td align="left">character vector</td>
<td align="left"><code>"?"</code></td>
<td align="left">❌</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">2nd-level loop iterator</td>
</tr>
<tr class="odd">
<td align="left"><code>j</code></td>
<td align="left">integer vector</td>
<td align="left"><code>NA_integer_</code></td>
<td align="left">❌</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">3rd-level loop iterator, i.e. “for each <code>lvl</code>, iterate over each <code>i</code>, and in turn iterate over every <code>j</code>”</td>
</tr>
<tr class="even">
<td align="left"><code>block</code></td>
<td align="left">character scalar</td>
<td align="left">top-level block name</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">holds the name of the respective top-level block; filled automatically during parsing</td>
</tr>
<tr class="odd">
<td align="left"><code>variable_name</code></td>
<td align="left">character scalar</td>
<td align="left"><code>"???"</code></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Variablenname”; mustn’t have any subkeys (see below); usually not sensible to be inherited since it has to be unique</td>
</tr>
<tr class="even">
<td align="left"><code>who</code></td>
<td align="left">character scalar</td>
<td align="left"></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Wer”</td>
</tr>
<tr class="odd">
<td align="left"><code>topic</code></td>
<td align="left">character scalar</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Thema”</td>
</tr>
<tr class="even">
<td align="left"><code>question</code></td>
<td align="left">character scalar</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Frage”</td>
</tr>
<tr class="odd">
<td align="left"><code>question_common</code></td>
<td align="left">character scalar</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">version of <code>question</code> that stays the same across ballot dates</td>
</tr>
<tr class="even">
<td align="left"><code>variable_label</code></td>
<td align="left">character scalar</td>
<td align="left"></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Variablenlabel”</td>
</tr>
<tr class="odd">
<td align="left"><code>variable_label_common</code></td>
<td align="left">character scalar</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">version of <code>variable_label</code> that stays the same across ballot dates</td>
</tr>
<tr class="even">
<td align="left"><code>response_options</code></td>
<td align="left">character vector</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Antwortoptionen”</td>
</tr>
<tr class="odd">
<td align="left"><code>variable_values</code></td>
<td align="left">integer vector</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Variablenausprägungen”</td>
</tr>
<tr class="even">
<td align="left"><code>value_labels</code></td>
<td align="left">character vector</td>
<td align="left"></td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Ausprägungslabels”</td>
</tr>
<tr class="odd">
<td align="left"><code>value_scale</code></td>
<td align="left">character scalar</td>
<td align="left"><code>"nominal"</code></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">item’s <a href="https://en.wikipedia.org/wiki/Level_of_measurement" class="external-link">scale of measure (aka “level of measurement”)</a>; possible values include <code>"binary"</code>, <code>"nominal"</code>, <code>"ordinal_ascending"</code>, <code>"ordinal_descending"</code>, <code>"interval"</code> and <code>"ratio"</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>multiple_answers_allowed</code></td>
<td align="left">logical scalar</td>
<td align="left"><code>FALSE</code></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">aka “Mehrfachnennungen”</td>
</tr>
<tr class="odd">
<td align="left"><code>randomize_response_options</code></td>
<td align="left">logical scalar</td>
<td align="left"><code>FALSE</code></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">whether or not the <code>response_options</code> are displayed in randomized order to online respondents (<code>response_options</code>) with code <code>80</code>, <code>90</code> and <code>99</code> are still excluded from randomization)</td>
</tr>
<tr class="even">
<td align="left"><code>ballot_types</code></td>
<td align="left">character vector</td>
<td align="left"><code><a href="https://rdrr.io/r/base/c.html" class="external-link">c("referendum", "election")</a></code></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">✅</td>
<td align="left">ballot-type-specific in- and exclusion of the respective item(s)</td>
</tr>
<tr class="odd">
<td align="left"><code>include</code></td>
<td align="left">logical scalar</td>
<td align="left"><code>TRUE</code></td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">✅</td>
<td align="left">ballot-date-wide in- and exclusion of the respective item(s)</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>The keys regarded on <code>item</code>-level nodes are resolved in the following order</p>
<ol style="list-style-type: decimal">
<li><code>lvl</code></li>
<li><code>i</code></li>
<li><code>j</code></li>
<li>All the other item-level keys.</li>
</ol>
</div>
<div id="further-notes" class="section level1">
<h1 class="hasAnchor">
<a href="#further-notes" class="anchor"></a>Further notes</h1>
<ul>
<li>
<p>All keys support <a href="https://glue.tidyverse.org/" class="external-link">glue’s string interpolation</a>, meaning that non-character-type keys like <code>include</code> or <code>variable_values</code> can also be specified as string (arrays) which will automatically be converted to their proper type during questionnaire generation.</p>
<p>More specifically, keys that hold <em>arrays</em> like <code>response_options</code> are fed to <a href="https://glue.tidyverse.org/reference/glue.html" class="external-link"><code>glue::glue()</code></a> allowing to use its powerful <a href="https://glue.tidyverse.org/" class="external-link">string interpolation syntax</a>, while the other keys holding <em>scalars</em> like <code>include</code> are fed to <a href="https://cli.r-lib.org/reference/pluralize.html" class="external-link"><code>cli::pluralize()</code></a> which additionally supports a <a href="https://cli.r-lib.org/articles/pluralization.html" class="external-link">handy pluralization syntax</a>. The default behavior of trimming all surrounding whitespaces is disabled in both cases.</p>
</li>
<li>
<p>To vary <em>non-binary keys</em> like <code>topic</code>, <code>question</code> etc. wordings at different ballot dates directly without relying on embedded R code, you can define</p>
<ul>
<li>single-date subkeys named <code>YYYYMMDD</code> (the respective ballot date without any <code><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">-</a></code>) applying to a single ballot date,</li>
<li>begin-end interval subkeys named <code>YYYYMMDD_YYYYMMDD</code> applying to all ballot dates that fall into the specified interval, or</li>
<li>
<code>default</code> (applying to any ballot dates for which no specific subkey exists).</li>
</ul>
<p>Interval subkeys mustn’t overlap. Single-date subkeys have precedence over interval subkeys.</p>
<p>To vary <em>binary keys</em> like <code>multiple_answers_allowed</code> or <code>include</code> directly, you can define</p>
<ul>
<li>begin-end interval subkeys as described above, or alternatively</li>
<li>subkeys named <code>true</code> (meaning inclusion) or <code>false</code> (meaning exclusion; has priority over <code>true</code> in case of ambiguity) containing an array of dates (<code>YYYY-MM-DD</code>), as well as</li>
<li>
<code>default</code> (applying to any ballot dates not included in the <code>true</code> or <code>false</code> subkeys).</li>
</ul>
<p>The <code>true</code>/<code>false</code> subkeys have precedence over begin-end interval subkeys.</p>
<p>To vary keys for different ballot types, just define subkeys named <code>referendum</code> or <code>election</code>.</p>
<p>Examples:</p>
<pre><code>topic.default = "bla"
topic.20180923 = "blup"
topic.20180923_20191020 = "boing"
include.default = true
include.false = [ 2018-09-23 ]
question.default.election = "lalala"
question.default.referendum = "nenene"</code></pre>
<p><strong>NOTES:</strong></p>
<ul>
<li>
<code>variable_name</code> is the only key that mustn’t have any subkeys.</li>
<li>The <code>default</code> subkeys of <code>question</code>/<code>variable_label</code> are also used as <code>question_common</code>/<code>variable_label_common</code> if the latter are not explicitly defined.</li>
</ul>
</li>
<li><p>The keys <code>lvl</code>, <code>i</code> and <code>j</code> are interpreted as iterators which you can refer to via string interpolation (e.g. <code>voting_decision_{lvl}</code>), so you have to define similar questionnaire items only once. If any of them evaluate to <code>NULL</code> or an empty vector, the respective item is automatically excluded, i.e. it’s not necessary to explicitly set <code>include</code> (sub)keys in such case.</p></li>
<li><p>You can even cross-reference keys from non-parent nodes using <a href="https://rpkg.dev/fokus/reference/q_item_val.html"><code>q_item_val()</code></a>. But be careful to not create infinite loops via circular references.</p></li>
<li><p>To explicitly unset a key, just assign a string containing <code>NA</code> of the correct type wrapped in curly braces (<code>"{NA_character_}"</code> for values of type string, <code>"{NA_integer_}"</code> for values of type integer etc.).</p></li>
<li><p>A <code>who</code> constraint notice is automatically added to the end of <code>variable_label</code> and <code>variable_label_common</code> if possible (e.g. <code>"blabla (only non-voters)"</code>). Because <code>variable_label_common</code> by definition mustn’t vary over time, it <strong>must</strong> be explicitly specified <em>including such a <code>who</code> constraint notice</em> <strong>if</strong> <code>who</code> varies over time.</p></li>
<li><p>This questionnaire is <a href="https://gitlab.com/zdaarau/rpkgs/fokus/-/tree/master/data-raw/questionnaire/" class="external-link">complemented by a <strong>supplemental TOML file <code>YYYY-MM-DD.toml</code></strong> for each ballot date</a> that holds additional date-specific metadata.</p></li>
</ul>
</div>
<div id="supplemental-assumptions-to-resolve-gluecli-string-interpolation" class="section level1">
<h1 class="hasAnchor">
<a href="#supplemental-assumptions-to-resolve-gluecli-string-interpolation" class="anchor"></a>Supplemental assumptions to resolve glue/cli string interpolation</h1>
<ul>
<li>
<p>The following R packages are loaded and <a href="https://rdrr.io/r/base/library.html" class="external-link">attached</a>.</p>
<ul>
<li><a href="https://rpkg.dev/fokus/">fokus</a></li>
<li><a href="https://magrittr.tidyverse.org/" class="external-link">magrittr</a></li>
</ul>
</li>
<li>
<p>The following R objects are present in the evaluation environment:</p>
<ul>
<li><p><code>ballot_date</code> (character scalar): The ballot date the questionnaire is to be generated for (in the format <code>YYYY-MM-DD</code>).</p></li>
<li><p><code>canton</code> (character scalar): The canton the questionnaire is to be generated for (all lowercase).</p></li>
</ul>
</li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1">
<p>Exceptions: The following tables/table arrays are not questionnaire blocks by themselves, but also don’t contain “atomic” questionnaire items.</p>
<ul>
<li><code>title</code></li>
<li><code>who</code></li>
<li><code>party</code></li>
<li><code>response_options</code></li>
<li><code>footnote</code></li>
<li><code>link</code></li>
</ul>
<a href="#fnref1" class="footnote-back">↩︎</a>
</li>
<li id="fn2"><p>The term “deepest” is kind of misleading here since there can actually be TOML table levels below the level of an “atomic” questionnaire item, namely to define <code>include</code> rules (e.g. <code>include.false = [ YYYY-MM-DD ]</code>) or to account for varying <code>topic</code>, <code>question</code> etc. wordings at different ballot dates (e.g. <code>topic.default = "bla"</code> and <code>topic.YYYYMMDD = "blup"</code>) or for different ballot types (e.g. <code>topic.default.election = "bla"</code> and <code>topic.default.referendum = "blup"</code>).<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Salim Brüggemann.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  

  

<script data-goatcounter="https://rpkg-dev.goatcounter.com/count" async src="../goatcounter.min.js"></script>
</body>
</html>
